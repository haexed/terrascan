{% extends "base.html" %}

{% block title %}Providers - Terrascan{% endblock %}

{% block header_subtitle %}Data Provider Ecosystem{% endblock %}

{% block content %}
<!-- Provider Overview Stats -->
<div class="card">
    <h3>üåê Provider Overview</h3>
    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-value">{{ total_providers }}</span>
            <div class="stat-label">Total Providers</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ active_providers }}</span>
            <div class="stat-label">Active Providers</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ total_datasets }}</span>
            <div class="stat-label">Available Datasets</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">${{ "%.2f"|format(total_api_cost / 100) }}</span>
            <div class="stat-label">Total API Costs</div>
        </div>
    </div>
</div>

<!-- Provider Grid -->
<div class="provider-grid">
    {% for provider in providers %}
    <div class="provider-item">
        <div class="provider-header">
            <h4>{{ provider.name }}</h4>
            <span class="task-status status-{{ 'active' if provider.is_active else 'inactive' }}">
                {{ 'Active' if provider.is_active else 'Inactive' }}
            </span>
        </div>

        <p><strong>Description:</strong> {{ provider.description or 'No description available' }}</p>

        {% if provider.website_url %}
        <p><strong>Website:</strong>
            <a href="{{ provider.website_url }}" target="_blank" class="provider-link">
                {{ provider.website_url }}
            </a>
        </p>
        {% endif %}

        {% if provider.api_documentation_url %}
        <p><strong>API Docs:</strong>
            <a href="{{ provider.api_documentation_url }}" target="_blank" class="provider-link">
                Documentation
            </a>
        </p>
        {% endif %}

        <div class="provider-stats">
            <div>
                <div class="stat-value">{{ provider.stats.total_requests or 0 }}</div>
                <div class="stat-label">API Requests</div>
            </div>
            <div>
                <div class="stat-value">{{ provider.stats.total_records or 0 }}</div>
                <div class="stat-label">Records Collected</div>
            </div>
            <div>
                <div class="stat-value">${{ "%.2f"|format((provider.stats.total_cost_cents or 0) / 100) }}</div>
                <div class="stat-label">Total Cost</div>
            </div>
        </div>

        {% if provider.datasets %}
        <h5>üìä Available Datasets:</h5>
        <ul style="margin: 0; padding-left: 20px;">
            {% for dataset in provider.datasets %}
            <li>
                <strong>{{ dataset.name }}</strong>
                {% if dataset.description %} - {{ dataset.description }}{% endif %}
                {% if dataset.record_count %}
                <br><small>{{ dataset.record_count }} records collected</small>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if provider.data_types %}
        <h5>üî¨ Data Types:</h5>
        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
            {% for data_type in provider.data_types %}
            <span style="background: #e9ecef; padding: 3px 8px; border-radius: 3px; font-size: 0.8em;">
                {{ data_type }}
            </span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

{% if not providers %}
<div class="card">
    <h3>No Providers Configured</h3>
    <p>No data providers are currently configured in the system.</p>
</div>
{% endif %}

<!-- API Information -->
<div class="card">
    <h3>üîó API Access</h3>
    <p>Access provider data programmatically using these endpoints:</p>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace;">
        <strong>Provider List:</strong><br>
        <code>GET /api/providers</code><br><br>

        <strong>Provider Details:</strong><br>
        <code>GET /api/providers/&lt;provider_key&gt;</code><br><br>

        <strong>Dataset Information:</strong><br>
        <code>GET /api/datasets/&lt;provider_key&gt;/&lt;dataset_name&gt;</code><br><br>

        <strong>Data Query:</strong><br>
        <code>GET /api/data?provider=&lt;key&gt;&amp;dataset=&lt;name&gt;&amp;limit=100</code>
    </div>
</div>
{% endblock %}
