{% extends "base.html" %}

{% block title %}Dashboard - Terrascan{% endblock %}

{% block header_subtitle %}Environmental Data Dashboard{% endblock %}

{% block content %}
<!-- System Stats -->
<div class="card">
    <h3>üìä System Overview</h3>
    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-value">{{ stats.total_tasks }}</span>
            <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ stats.total_runs }}</span>
            <div class="stat-label">Total Runs</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ stats.total_records }}</span>
            <div class="stat-label">Records Collected</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">${{ "%.2f"|format(stats.total_cost_cents / 100) }}</span>
            <div class="stat-label">Total Cost</div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <h3>üïí Recent Activity</h3>
    {% if recent_logs %}
    {% for log in recent_logs %}
    <div class="log-item log-{{ log.status }}">
        <div class="log-header" onclick="toggleLogDetails(this)">
            <div>
                <span class="toggle-icon">‚ñ∂Ô∏è</span>
                <strong>{{ log.task_name }}</strong> |
                <span class="task-status status-{{ 'active' if log.status == 'completed' else 'inactive' }}">
                    {{ log.status.upper() }}
                </span> |
                {{ log.started_at }} |
                Duration: {{ log.duration_seconds }}s
            </div>
            {% if log.records_processed %}
            <span>{{ log.records_processed }} records</span>
            {% endif %}
        </div>
        <div class="log-content">
            {% if log.status == 'failed' %}
            <p><strong>‚ùå Error Details</strong></p>
            <pre>{{ log.error_message }}</pre>
            {% if log.stack_trace %}
            <p><strong>‚ñº Full Stack Trace</strong></p>
            <pre>{{ log.stack_trace }}</pre>
            {% endif %}
            {% else %}
            <p><strong>‚ñ∫ Output</strong></p>
            <pre>{{ log.output or 'No output' }}</pre>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-muted">No recent activity found.</p>
    {% endif %}
</div>

<!-- Quick Actions -->
<div class="card">
    <h3>‚ö° Quick Actions</h3>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        {% for task in quick_tasks %}
        <button class="run-btn" onclick="runTask('{{ task.name }}')">
            üöÄ Run {{ task.name }}
        </button>
        {% endfor %}
        <a href="/tasks" class="run-btn btn-secondary" style="text-decoration: none; display: inline-block;">
            üîß Manage All Tasks
        </a>
    </div>
</div>
{% endblock %}
