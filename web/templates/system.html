{% extends "base.html" %}

{% block title %}System Logs - Terrascan{% endblock %}

{% block header_subtitle %}Complete log of all task executions with full transparency{% endblock %}

{% block content %}
<!-- System Status Summary -->
<div class="card">
    <h3>üñ•Ô∏è System Health</h3>
    <div class="stats-grid">
        <div class="stat-box">
            <span class="stat-value">{{ system_health.status.title() }}</span>
            <div class="stat-label">System Status</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ system_health.running_tasks }}</span>
            <div class="stat-label">Running Tasks</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ system_health.success_rate }}%</span>
            <div class="stat-label">Success Rate</div>
        </div>
        <div class="stat-box">
            <span class="stat-value">{{ system_health.uptime_days }}d</span>
            <div class="stat-label">System Uptime</div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <h3>üìã Recent System Activity</h3>
    <p class="text-muted">Complete log of all task executions with full transparency</p>

    {% if logs %}
    {% for log in logs %}
    <div class="log-item log-{{ log.status }}">
        <div class="log-header" onclick="toggleLogDetails(this)">
            <div>
                <span class="toggle-icon">‚ñ∂Ô∏è</span>
                <strong>{{ log.task_name }}</strong> |
                <span class="task-status status-{{ 'active' if log.status == 'completed' else 'inactive' }}">
                    {{ log.status.upper() }}
                </span> |
                {{ log.started_at }} |
                Duration: {{ log.duration_seconds }}s
            </div>
            {% if log.records_processed %}
            <span>{{ log.records_processed }} records</span>
            {% endif %}
        </div>
        <div class="log-content">
            {% if log.status == 'failed' %}
            <p><strong>‚ùå Error Details</strong></p>
            <pre>{{ log.error_message }}</pre>
            {% if log.stack_trace %}
            <p><strong>‚ñº Full Stack Trace</strong></p>
            <pre>{{ log.stack_trace }}</pre>
            {% endif %}
            {% else %}
            <p><strong>‚ñ∫ Output</strong></p>
            <pre>{{ log.output or 'No output' }}</pre>
            {% endif %}

            {% if log.metadata %}
            <p><strong>üìä Metadata</strong></p>
            <pre>{{ log.metadata }}</pre>
            {% endif %}

            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                <small class="text-muted">
                    <strong>Run ID:</strong> {{ log.run_id }} |
                    <strong>Started:</strong> {{ log.started_at }} |
                    {% if log.completed_at %}
                    <strong>Completed:</strong> {{ log.completed_at }} |
                    {% endif %}
                    <strong>Duration:</strong> {{ log.duration_seconds }}s |
                    <strong>Cost:</strong> ${{ "%.4f"|format((log.actual_cost_cents or 0) / 100) }}
                </small>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-muted">No system logs available.</p>
    {% endif %}
</div>

<!-- System Configuration -->
<div class="card">
    <h3>‚öôÔ∏è System Configuration</h3>
    <table class="data-table">
        <thead>
            <tr>
                <th>Setting</th>
                <th>Value</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for config in system_config %}
            <tr>
                <td><code>{{ config.key }}</code></td>
                <td>
                    {% if config.value_type == 'boolean' %}
                    <span class="task-status status-{{ 'active' if config.value == 'true' else 'inactive' }}">
                        {{ config.value.title() }}
                    </span>
                    {% else %}
                    {{ config.value }}
                    {% endif %}
                </td>
                <td>{{ config.description or 'No description' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Transparency Notice -->
<div class="card" style="background: #e3f2fd; border: 1px solid #bbdefb;">
    <h3>üîç Full Transparency Policy</h3>
    <p>
        <strong>Terrascan operates with complete transparency.</strong> All costs, API calls, errors, and system logs
        are publicly visible.
        This ensures accountability and allows users to understand exactly how the platform operates.
    </p>
    <ul>
        <li>‚úÖ All task executions are logged with full details</li>
        <li>‚úÖ Error messages include complete stack traces</li>
        <li>‚úÖ API costs are tracked and displayed</li>
        <li>‚úÖ System configuration is publicly accessible</li>
        <li>‚úÖ Source code is available for inspection</li>
    </ul>
    <p>
        Want to contribute or report an issue?
        <a href="https://github.com/haexed/terrascan" target="_blank" class="provider-link">
            Visit our GitHub repository
        </a>
    </p>
</div>
{% endblock %}
