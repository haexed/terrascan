{% extends "base.html" %}

{% block title %}üåç Terrascan - Keep watch on our planet. Every day.{% endblock %}

{% block leaflet_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block extra_css %}
<!-- Hero map styles are now in main style.css -->
{% endblock %}

{% block content %}
<!-- Main Content -->
<div class="container-fluid mt-5 pt-4">


    <!-- Environmental Health Score -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="eco-card text-center p-4">
                <h2 class="mb-3">üåç Planetary Health</h2>
                <div class="health-score status-{{ health_score.status.lower().replace('_', '-') }}">
                    {% if health_score.score is not none %}{{ health_score.score }}/100{% else %}No Data{% endif %}
                </div>
                <h3 class="mt-2 status-{{ health_score.status.lower().replace('_', '-') }}">
                    {{ health_score.status.replace('_', ' ') }}
                </h3>
                <p class="mt-3">
                    Based on current fire activity, air quality, and ocean conditions
                </p>
            </div>
        </div>
    </div>

    <!-- Environmental Indicators -->
    <div class="row g-4 mb-4">
        <!-- Fire Status -->
        <div class="col-lg-4">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üî•</span>
                    <div>
                        <h4 class="mb-0">Global Fires</h4>
                        <div class="data-source">
                            NASA FIRMS
                            {% if freshness.nasa_firms %}
                            <span class="freshness-badge" style="background: {{ freshness.nasa_firms.color }};" title="{{ freshness.nasa_firms.age_hours }}h ago">
                                {{ freshness.nasa_firms.status }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <div class="metric-value {{ fire_data.active_fires.css_class }}">
                        {{ fire_data.active_fires }}
                    </div>
                    <div class="mb-2">Active Fires (24h)</div>

                    {% if fire_data.avg_brightness %}
                    <div class="small">
                        Avg Brightness: {{ fire_data.avg_brightness }}
                    </div>
                    {% endif %}

                    <div class="mt-3">
                        <span class="badge {{ fire_data.active_fires.badge_class }} pulse">
                            {{ fire_data.active_fires.status|upper }}
                        </span>
                    </div>
                </div>

                <div class="last-update mt-3 text-center">
                    {% if freshness.nasa_firms %}
                    Updated {{ freshness.nasa_firms.age_hours }}h ago
                    {% else %}
                    No data
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Air Quality -->
        <div class="col-lg-4">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üå¨Ô∏è</span>
                    <div>
                        <h4 class="mb-0">Air Quality</h4>
                        <div class="data-source">
                            OpenAQ
                            {% if freshness.openaq %}
                            <span class="freshness-badge" style="background: {{ freshness.openaq.color }};" title="{{ freshness.openaq.age_hours }}h ago">
                                {{ freshness.openaq.status }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <div class="metric-value {{ air_data.avg_pm25.css_class }}">
                        {{ air_data.avg_pm25 }}
                    </div>
                    <div class="mb-2">PM2.5 (Global Avg)</div>

                    {% if air_data.measurements %}
                    <div class="small">
                        {{ air_data.measurements }} measurements
                    </div>
                    {% endif %}

                    <div class="mt-3">
                        <span class="badge {{ air_data.avg_pm25.badge_class }}">
                            {{ air_data.avg_pm25.status|upper }}
                        </span>
                    </div>
                </div>

                <div class="last-update mt-3 text-center">
                    {% if freshness.openaq %}
                    Updated {{ freshness.openaq.age_hours }}h ago
                    {% else %}
                    No data
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Ocean Health -->
        <div class="col-lg-4">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üåä</span>
                    <div>
                        <h4 class="mb-0">Ocean Health</h4>
                        <div class="data-source">
                            Open-Meteo
                            {% if freshness.openmeteo_marine %}
                            <span class="freshness-badge" style="background: {{ freshness.openmeteo_marine.color }};" title="{{ freshness.openmeteo_marine.age_hours }}h ago">
                                {{ freshness.openmeteo_marine.status }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <div class="metric-value {{ ocean_data.avg_temp.css_class }}" id="ocean-temp-display">
                        {{ ocean_data.avg_temp }}
                    </div>
                    <div class="mb-2">{{ ocean_data.metric_name }}</div>

                    {% if ocean_data.measurements %}
                    <div class="small">
                        {{ ocean_data.measurements }} measurements
                    </div>
                    {% endif %}

                    <div class="mt-3">
                        <span class="badge {{ ocean_data.avg_temp.badge_class }}">
                            {{ ocean_data.avg_temp.status|upper }}
                        </span>
                    </div>
                </div>

                <div class="last-update mt-3 text-center">
                    {% if freshness.openmeteo_marine %}
                    Updated {{ freshness.openmeteo_marine.age_hours }}h ago
                    {% else %}
                    No data
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Weather & Climate Row -->
    <div class="row mb-4">
        <!-- Global Weather -->
        <div class="col-lg-6">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üå°Ô∏è</span>
                    <div>
                        <h4 class="mb-0">Global Weather</h4>
                        <div class="data-source">OpenWeatherMap Network</div>
                    </div>
                </div>

                <div class="row text-center">
                    <div class="col-6">
                        <div class="metric-value text-primary">{{ weather_data.avg_temp }}</div>
                        <div class="small">Average Temperature</div>
                    </div>
                    <div class="col-6">
                        <div class="metric-value text-info">{{ weather_data.avg_humidity }}</div>
                        <div class="small">Average Humidity</div>
                    </div>
                </div>

                <div class="row text-center mt-3">
                    <div class="col-6">
                        <div class="metric-value text-secondary">{{ weather_data.avg_wind_speed }}</div>
                        <div class="small">Average Wind Speed</div>
                    </div>
                    <div class="col-6">
                        <div class="metric-value text-dark">{{ weather_data.avg_pressure }}</div>
                        <div class="small">Average Pressure</div>
                    </div>
                </div>

                {% if weather_data.city_count and weather_data.city_count > 0 %}
                <div class="text-center mt-3">
                    <div class="small">
                        {{ weather_data.city_count }} cities monitored
                    </div>
                </div>
                {% endif %}

                <div class="last-update mt-3 text-center">
                    Last update: {{ weather_data.last_update }}
                </div>
            </div>
        </div>

        <!-- Weather Alerts -->
        <div class="col-lg-6">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üö®</span>
                    <div>
                        <h4 class="mb-0">Weather Alerts</h4>
                        <div class="data-source">Government Weather Services</div>
                    </div>
                </div>

                <div class="text-center">
                    <div
                        class="metric-value {{ weather_data.alert_count.css_class }}">
                        {{ weather_data.alert_count }}
                    </div>
                    <div class="mb-2">Active Weather Alerts</div>

                    <div class="mt-3">
                        <span
                            class="badge {{ weather_data.alert_count.badge_class }}">
                            {% if weather_data.alert_count.value == 0 %}
                            ALL CLEAR
                            {% elif weather_data.alert_count.value and weather_data.alert_count.value <= 2 %} LOW RISK {% elif weather_data.alert_count.value and weather_data.alert_count.value <= 5 %}
                                MODERATE RISK {% else %} HIGH RISK {% endif %} </span>
                    </div>
                </div>

                {% if weather_data.alert_count and weather_data.alert_count > 0 %}
                <div class="text-center mt-3">
                    <div class="small">
                        Includes severe weather warnings, heat advisories, storm alerts, and other government-issued
                        weather notices
                    </div>
                </div>
                {% endif %}

                <div class="last-update mt-3 text-center">
                    Last update: {{ weather_data.last_update }}
                </div>
            </div>
        </div>
    </div>

    <!-- Biodiversity & Ecosystems Row -->
    <div class="row mb-4">
        <!-- Species Diversity -->
        <div class="col-lg-6">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">ü¶ã</span>
                    <div>
                        <h4 class="mb-0">Species Diversity</h4>
                        <div class="data-source">GBIF Global Network</div>
                    </div>
                </div>

                <div class="row text-center">
                    <div class="col-6">
                        <div class="metric-value text-success">{{ biodiversity_data.total_observations }}</div>
                        <div class="small">Total Species Observations</div>
                    </div>
                    <div class="col-6">
                        <div class="metric-value text-info">{{ biodiversity_data.avg_diversity }}</div>
                        <div class="small">Average Species per Region</div>
                    </div>
                </div>

                <div class="row text-center mt-3">
                    <div class="col-12">
                        <div class="metric-value text-primary">{{ biodiversity_data.region_count }}</div>
                        <div class="small">Biodiversity Hotspots Monitored</div>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <span
                        class="badge {{ biodiversity_data.avg_diversity.badge_class }}">
                        {% if biodiversity_data.avg_diversity.value and biodiversity_data.avg_diversity.value > 15 %}
                        HIGH DIVERSITY
                        {% elif biodiversity_data.avg_diversity.value and biodiversity_data.avg_diversity.value > 10 %}
                        GOOD DIVERSITY
                        {% elif biodiversity_data.avg_diversity.value and biodiversity_data.avg_diversity.value > 5 %}
                        MODERATE DIVERSITY
                        {% else %}
                        LOW DIVERSITY
                        {% endif %}
                    </span>
                </div>

                <div class="last-update mt-3 text-center">
                    Last update: {{ biodiversity_data.last_update }}
                </div>
            </div>
        </div>

        <!-- Ecosystem Health -->
        <div class="col-lg-6">
            <div class="eco-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <span class="fs-1 me-3">üåø</span>
                    <div>
                        <h4 class="mb-0">Ecosystem Health</h4>
                        <div class="data-source">Global Biodiversity Monitoring</div>
                    </div>
                </div>

                <div class="text-center">
                    <div
                        class="metric-value {{ biodiversity_data.avg_observations.css_class }}">
                        {{ biodiversity_data.avg_observations }}
                    </div>
                    <div class="mb-2">Average Observations per Region</div>

                    <div class="mt-3">
                        <span
                            class="badge {{ biodiversity_data.avg_observations.badge_class }}">
                            {% if biodiversity_data.avg_observations.value and biodiversity_data.avg_observations.value > 1000 %}
                            THRIVING ECOSYSTEMS
                            {% elif biodiversity_data.avg_observations.value and biodiversity_data.avg_observations.value > 500 %}
                            HEALTHY ECOSYSTEMS
                            {% elif biodiversity_data.avg_observations.value and biodiversity_data.avg_observations.value > 100 %}
                            MODERATE ACTIVITY
                            {% else %}
                            LOW ACTIVITY
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <div class="small">
                        Monitoring {{ biodiversity_data.region_count }} major biodiversity hotspots including Amazon,
                        Serengeti, Great Barrier Reef, and more
                    </div>
                </div>

                <div class="last-update mt-3 text-center">
                    Last update: {{ biodiversity_data.last_update }}
                </div>
            </div>
        </div>
    </div>

    <!-- Map section removed from status page - use /map for full map view -->

    <!-- Call to Action -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="eco-card text-center p-4">
                <h4 class="mb-3">üå± Environmental Awareness for Everyone</h4>
                <p class="mb-3">
                    Terrascan makes complex environmental data accessible to everyone.
                    Monitor our planet's health in real-time with data from NASA, NOAA, and OpenAQ.
                </p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="/map" class="btn btn-success">
                        <i class="fas fa-globe"></i> Explore Map
                    </a>
                    <a href="/system" class="btn btn-success">
                        <i class="fas fa-server"></i> System Status
                    </a>
                    <a href="/about" class="btn btn-success">
                        <i class="fas fa-info-circle"></i> Learn More
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Force refresh function for cache issues
    function forceRefresh() {
        if (confirm('üîÑ This will refresh the page with fresh data. Continue?')) {
            // Add timestamp to force cache bust
            const timestamp = new Date().getTime();
            window.location.href = window.location.href.split('?')[0] + '?cache_bust=' + timestamp;
        }
    }
</script>
{% endblock %}
