{% extends "base.html" %}

{% block title %}ğŸŒ Terrascan - Live Planetary Monitoring{% endblock %}

{% block leaflet_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}">
{% endblock %}



{% block content %}
<!-- Aggregate Stats Banner -->
<div class="stats-banner">
    <div class="stats-banner-content">
        <div class="stat-item">
            <span class="stat-icon">ğŸ”¥</span>
            <span class="stat-value" id="banner-fires">{{ health_data.fires.count if health_data.fires.count else 'â€”' }}</span>
            <span class="stat-label">Active Fires</span>
        </div>
        <div class="stat-item">
            <span class="stat-icon">ğŸŒ¬ï¸</span>
            <span class="stat-value" id="banner-air">{{ health_data.air_quality.avg_pm25 if health_data.air_quality.avg_pm25 else 'â€”' }}{{ ' Î¼g/mÂ³' if health_data.air_quality.avg_pm25 else '' }}</span>
            <span class="stat-label">Global AQI</span>
        </div>
        <div class="stat-item">
            <span class="stat-icon">ğŸŒŠ</span>
            <span class="stat-value" id="banner-ocean">{{ health_data.ocean_temperature.avg_temp if health_data.ocean_temperature.avg_temp else 'â€”' }}{{ 'Â°C' if health_data.ocean_temperature.avg_temp else '' }}</span>
            <span class="stat-label">Ocean Temp</span>
        </div>
        <div class="stat-item">
            <span class="stat-icon">ğŸŒ</span>
            <span class="stat-value" id="banner-health">{{ health_score.score if health_score.score else 'â€”' }}/100</span>
            <span class="stat-label">Health Score</span>
        </div>
        <div class="stat-item scan-status" id="scan-status-banner" style="display: none;">
            <span class="stat-icon">ğŸ”</span>
            <span class="stat-value">Scanning...</span>
        </div>
    </div>
</div>

<!-- Main Map Container -->
<div id="map"></div>

<!-- Control Panel -->
<div class="control-panel">
    <h5 class="mb-3"><strong>ğŸŒ Terrascan</strong></h5>
    <p class="small mb-3">Live Environmental Layers</p>

    <!-- Fire Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="fire-layer" checked>
        <span class="layer-icon">ğŸ”¥</span>
        <div>
            <strong>Active Fires</strong>
            <div class="small">NASA FIRMS</div>
        </div>
    </div>

    <!-- Air Quality Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="air-layer" checked>
        <span class="layer-icon">ğŸŒ¬ï¸</span>
        <div>
            <strong>Air Quality</strong>
            <div class="small">OpenAQ PM2.5</div>
        </div>
    </div>

    <!-- Ocean Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="ocean-layer" checked>
        <span class="layer-icon">ğŸŒŠ</span>
        <div>
            <strong>Ocean Temp</strong>
            <div class="small">Open-Meteo SST</div>
        </div>
    </div>

    <!-- Conflict Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="conflict-layer" checked>
        <span class="layer-icon">âš”ï¸</span>
        <div>
            <strong>Conflicts</strong>
            <div class="small">UCDP Events</div>
        </div>
    </div>

    <!-- Biodiversity Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="biodiversity-layer" checked>
        <span class="layer-icon">ğŸ¦‹</span>
        <div>
            <strong>Biodiversity</strong>
            <div class="small">GBIF Hotspots</div>
        </div>
    </div>

    <!-- Aurora Layer Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="aurora-layer" checked>
        <span class="layer-icon">ğŸŒŒ</span>
        <div>
            <strong>Aurora</strong>
            <div class="small" id="kp-status">NOAA SWPC</div>
        </div>
    </div>

    <hr class="my-3">

    <!-- Map Style Toggle -->
    <div class="layer-toggle">
        <input type="checkbox" id="satellite-view" checked>
        <span class="layer-icon">ğŸ›°ï¸</span>
        <div>
            <strong>Satellite View</strong>
            <div class="small">High Resolution</div>
        </div>
    </div>
</div>

<!-- Health Score Widget -->
<div class="health-score-widget">
    <h6 class="mb-2">ğŸŒ PLANETARY HEALTH</h6>
    <div class="health-score status-{{ health_score.status.lower() if health_score else 'unknown' }}">
        {{ health_score.score if health_score else '--' }}/100
    </div>
    <div class="mt-1 small status-{{ health_score.status.lower() if health_score else 'unknown' }}">
        {{ health_score.status if health_score else 'âšª NO DATA' }}
    </div>
    <div class="small mt-2">
        <i class="fas fa-clock"></i> <span id="map-current-time">Loading...</span>
    </div>
</div>

<!-- Refresh Button -->
<button class="refresh-btn" onclick="refreshMapData()" title="Refresh Environmental Data">
    <i class="fas fa-sync-alt text-white fs-4" id="refresh-icon"></i>
</button>
{% endblock %}

{% block footer_container %}{% endblock %}

{% block leaflet_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}
